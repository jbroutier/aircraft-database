{% extends '_layouts/default.html.twig' %}

{% block title %}{{ 'Search'|trans }} - {{ parent() }}{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center gap-3">
    <a class="d-none d-md-block" href="{{ path('index') }}">
      <img src="{{ asset('assets/images/logo.svg') }}" height="80" alt="">
    </a>

    {% include '_partials/search.html.twig' %}

  </div>
  <div class="card card-body">
    <h3>{{ 'Search results for «%query%»'|trans({ '%query%': app.request.query.get('query') }) }}</h3>
    <p class="card-text text-muted">
      {{ '{0}No results found|{1}1 result found|]1,Inf[%nbResults% results found'|trans({
        '%count%': results.nbResults,
        '%nbResults%': results.nbResults|format_number
      })|raw }}

      {% if results is not empty %}
        -
        {{ 'Page %currentPage% out of %nbPages%'|trans({
          '%currentPage%': results.currentPage|format_number,
          '%nbPages%': results.nbPages|format_number
        })|raw }}
      {% endif %}

    </p>
  </div>
  <div class="d-flex flex-column gap-2">

    {% for result in results %}

      {% set result = result|first %}

      {% if result is instanceOf('App\\Entity\\AircraftModel') %}
        {% set route = 'database_aircraft_model_read' %}
      {% elseif result is instanceOf('App\\Entity\\AircraftType') %}
        {% set route = 'database_aircraft_type_read' %}
      {% elseif result is instanceOf('App\\Entity\\EngineModel') %}
        {% set route = 'database_engine_model_read' %}
      {% elseif result is instanceOf('App\\Entity\\Manufacturer') %}
        {% set route = 'database_manufacturer_read' %}
      {% endif %}

      <div class="card flex-md-row">
        <a href="{{ path(route, { slug: result.slug }) }}">
          <div class="card-img-top overflow-hidden d-md-none">

            {% if result.pictures is not empty %}
              <img class="img-fluid"
                   src="{{ asset('pictures/' ~ result.pictures|first)|imagine_filter('thumbnail_560x320') }}"
                   width="560" height="320" alt="">
            {% else %}
              <img class="img-fluid" src="{{ asset('assets/images/no-picture-560x320.webp') }}"
                   width="560" height="320" alt="">
            {% endif %}

          </div>
          <div class="card-img-left overflow-hidden d-none d-md-block">

            {% if result.pictures is not empty %}
              <img class="img-fluid"
                   src="{{ asset('pictures/' ~ result.pictures|first)|imagine_filter('thumbnail_280x160') }}"
                   width="280" height="160" alt="">
            {% else %}
              <img class="img-fluid" src="{{ asset('assets/images/no-picture-280x160.webp') }}"
                   width="280" height="160" alt="">
            {% endif %}

          </div>
        </a>
        <div class="card-body">
          <a href="{{ path(route, { slug: result.slug }) }}">
            <h4>{{ result.name }}</h4>
          </a>

          {% if result.manufacturer is defined and result.manufacturer is not null %}
            <p class="card-text">

              {% if result.manufacturer.country is not null %}
                <span data-bs-toggle="tooltip"
                      title="{{ result.manufacturer.country|country_name|escape('html_attr') }}">
                  <span class="fp {{ result.manufacturer.country|lower }} me-2"></span>
                </span>
              {% else %}
                <span data-bs-toggle="tooltip" title="{{ 'International'|trans }}">
                  <span class="fp intl me-2"></span>
                </span>
              {% endif %}

              {{ result.manufacturer.name }}
            </p>
          {% endif %}

          {% if result is instanceOf('App\\Entity\\Manufacturer') %}
            <p class="card-text">

              {% if result.country is not null %}
                <span class="fp {{ result.country|lower }} me-2"></span>
                {{ result.country|country_name }}
              {% else %}
                <span class="fp intl me-2"></span>
                {{ 'International'|trans }}
              {% endif %}

            </p>
          {% endif %}

          <p class="card-text small text-muted">

            {% if result is instanceOf('App\\Entity\\AircraftModel') %}
              <span class="fal fa-plane-engines me-1" aria-hidden="true"></span>
              {{ 'Aircraft model'|trans }}
            {% elseif result is instanceOf('App\\Entity\\AircraftType') %}
              <span class="fal fa-plane-engines me-1" aria-hidden="true"></span>
              {{ 'Aircraft type'|trans }}
            {% elseif result is instanceOf('App\\Entity\\EngineModel') %}
              <span class="fal fa-engine me-1" aria-hidden="true"></span>
              {{ 'Engine model'|trans }}
            {% elseif result is instanceOf('App\\Entity\\Manufacturer') %}
              <span class="fal fa-industry-windows me-1" aria-hidden="true"></span>
              {{ 'Manufacturer'|trans }}
            {% endif %}

          </p>
        </div>
      </div>
    {% endfor %}

  </div>

  {% if results.haveToPaginate %}
    <div class="d-flex justify-content-center">
      {{ pagerfanta(results) }}
    </div>
  {% endif %}

{% endblock %}
